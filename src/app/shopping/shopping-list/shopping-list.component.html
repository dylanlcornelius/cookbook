<app-loading-modal *ngIf="loading"></app-loading-modal>
<app-validation-modal [validationModalParams]="validationModalParams"></app-validation-modal>
<app-notification-modal [notificationModalParams]="notificationModalParams"></app-notification-modal>

<h2>Your Shopping List</h2>

<div *ngIf="!loading">
  <form class="item-form" [formGroup]="itemForm" (ngSubmit)="addItem(itemForm.value)">
    <mat-form-field class="item-form-field">
      <input matInput placeholder="Add item" formControlName="name">
    </mat-form-field>

    <button mat-mini-fab matTooltip="Save Item" type="submit" color="primary">
      <mat-icon>done</mat-icon>
    </button>
  </form>

  <div *ngIf="!simplifiedView">
    <div class="table-container ingredients-table mat-elevation-z8" *ngIf="ingredientsDataSource.filteredData.length > 0">
      <mat-table #table [dataSource]="ingredientsDataSource">
        <ng-container matColumnDef="name">
          <mat-header-cell *matHeaderCellDef>Ingredient Name</mat-header-cell>
          <mat-cell *matCellDef="let element">
            <span class="mobile-label">Name:</span>
            <span class="mobile-value">{{element.name}}</span>
          </mat-cell>
        </ng-container>
  
        <ng-container matColumnDef="pantryQuantity">
          <mat-header-cell *matHeaderCellDef>Ingredients in Pantry</mat-header-cell>
          <mat-cell *matCellDef="let element">
            <span class="mobile-label">Pantry Quantity:&nbsp;</span>
            <span class="mobile-value">{{element.pantryQuantity | number: '1.0-2'}} {{element.uom === 'other'? '' : element.uom}}</span>
          </mat-cell>
        </ng-container>
  
        <ng-container matColumnDef="cartQuantity">
          <mat-header-cell *matHeaderCellDef>Ingredients Needed</mat-header-cell>
          <mat-cell *matCellDef="let element">
            <span class="mobile-label">List Quantity:&nbsp;&nbsp;</span>
  
            <span class="mobile-value">
              <button mat-button (click)="removeIngredient(element.id)">
                <mat-icon class="buy-icon">arrow_left</mat-icon>
              </button>
              <span style="margin: 0 10px;">
                {{element.cartQuantity}} {{element.uom === 'other'? '' : element.uom}}
              </span>
              <button mat-button (click)="addIngredient(element.id)">
                <mat-icon class="buy-icon">arrow_right</mat-icon>
              </button>
            </span>
          </mat-cell>
        </ng-container>
  
        <ng-container matColumnDef="buy">
          <mat-header-cell *matHeaderCellDef>Add to Pantry</mat-header-cell>
          <mat-cell *matCellDef="let element">
            <span class="mobile-label">Add to Pantry:&nbsp;&nbsp;</span>
            <span class="mobile-value">
              <button mat-raised-button color="primary" (click)="addIngredientToPantry(element.id)">
                <mat-icon>done</mat-icon>
              </button>
            </span>
          </mat-cell>
        </ng-container>
  
        <mat-header-row *matHeaderRowDef="['name', 'pantryQuantity', 'cartQuantity', 'buy']"></mat-header-row>
        <mat-row *matRowDef="let row; columns: ['name', 'pantryQuantity', 'cartQuantity', 'buy'];"></mat-row>
      </mat-table>
    </div>
    <br>
  
    <div class="table-container items-table mat-elevation-z8" *ngIf="itemsDataSource.filteredData.length > 0">
      <mat-table #table [dataSource]="itemsDataSource">
        <ng-container matColumnDef="name">
          <mat-header-cell *matHeaderCellDef>Item Name</mat-header-cell>
          <mat-cell *matCellDef="let element">
            <span class="mobile-label">Name:</span>
            <span class="mobile-value">{{element.name}}</span>
          </mat-cell>
        </ng-container>
  
        <ng-container matColumnDef="buy">
          <mat-header-cell *matHeaderCellDef>Remove from Cart</mat-header-cell>
          <mat-cell *matCellDef="let element; let i = index">
            <span class="mobile-label">Remove from Cart:</span>
            <span class="mobile-value">
              <button mat-raised-button color="primary" (click)="removeItem(i)">
                <mat-icon>done</mat-icon>
              </button>
            </span>
          </mat-cell>
        </ng-container>
        
        <mat-header-row *matHeaderRowDef="['name', 'buy']"></mat-header-row>
        <mat-row *matRowDef="let row; columns: ['name', 'buy'];"></mat-row>
      </mat-table>
    </div>
  </div>
    
  <div *ngIf="simplifiedView" class="d-flex justify-content-center">
    <div class="simplified">
      <div class="table-container mat-elevation-z8" *ngIf="ingredientsDataSource.filteredData.length > 0"
          [ngClass]="{'ingredients-table': itemsDataSource.filteredData.length === 0}">
        <mat-table #table [dataSource]="ingredientsDataSource">
          <ng-container matColumnDef="name">
            <mat-cell *matCellDef="let element">
              {{element.cartQuantity | number: '1.0-2'}} {{element.uom === 'other'? '' : element.uom}}
              {{element.name}}
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="buy">
            <mat-cell *matCellDef="let element">
              <button mat-raised-button color="primary" (click)="addIngredientToPantry(element.id)">
                <mat-icon>done</mat-icon>
              </button>
            </mat-cell>
          </ng-container>
    
          <mat-row *matRowDef="let row; columns: ['name', 'buy'];"></mat-row>
        </mat-table>
      </div>
    
      <div class="table-container items-table mat-elevation-z8" *ngIf="itemsDataSource.filteredData.length > 0">
        <mat-table #table [dataSource]="itemsDataSource">
          <ng-container matColumnDef="name">
            <mat-cell *matCellDef="let element">{{element.name}}</mat-cell>
          </ng-container>
    
          <ng-container matColumnDef="buy">
            <mat-cell *matCellDef="let element; let i = index;">
              <button mat-raised-button color="primary" (click)="removeItem(i)">
                <mat-icon>done</mat-icon>
              </button>
            </mat-cell>
          </ng-container>
          
          <mat-row *matRowDef="let row; columns: ['name', 'buy'];"></mat-row>
        </mat-table>
      </div>
    </div>
  </div>

  <div class="button-row" *ngIf="ingredientsDataSource.filteredData.length > 0 || itemsDataSource.filteredData.length > 0">
    <button mat-raised-button color="primary" style="float: right;" (click)="addAllToPantry()">Add All</button>
  </div>
</div>

<div *ngIf="!loading && ingredientsDataSource.filteredData.length == 0 && itemsDataSource.filteredData.length == 0" style="text-align: center;">
  <br/>
  <h4 [hidden]="isCompleted">No ingredients or items have been added to your shopping list</h4>
  <h4 [hidden]="!isCompleted">Shopping list completed!</h4>
</div>